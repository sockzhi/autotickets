# Automation and Web Interaction with Playwright

This repository contains a Python-based automation script for interacting with web pages using LLM and Playwright. The script is designed to perform web scraping, manipulate web elements, and interact with dynamic content. It includes a specific use case for automating flight search on a booking website by extracting actions and interacting with elements based on a natural language description of goals.

[![demo](https://img.youtube.com/vi/rEzxysmui6Y/0.jpg)](https://youtu.be/rEzxysmui6Y)


## Features

- **Web Automation**: Uses Playwright to launch browsers and navigate web pages.
- **Web Scraping**: Extracts web elements and their attributes for interaction.
- **Natural Language Processing (NLP)**: Leverages Groq API for generating responses from an LLM (Large Language Model) to interpret web page interactions.
- **Dynamic Content Handling**: Automatically handles elements like SVGs, text input, and clickable buttons.
- **Element Tree Management**: Cleans up and processes the DOM (Document Object Model) tree for better manipulation.
- **Actionable Prompts**: Generates dynamic interaction prompts based on the page's state and user goal.
  
## Prerequisites

- Python 3.11
- Install required libraries by running:

```bash
pip install playwright groq jinja2 beautifulsoup4 structlog
```

- Make sure to install Playwright dependencies:

```bash
playwright install
```

## Usage

1. **Configure API Key**:  
   Set your Groq API key in the `api_key` variable to allow communication with the Groq service for generating responses.

2. **Customize Goal**:  
   Modify the `navigation_goal` variable to specify the task the script should perform, such as "search a flight" or other dynamic tasks on websites.

3. **Run the Script**:  
   Execute the script to start interacting with the web page. The script will:
   - Open a browser and navigate to the specified URL (default: booking.com).
   - Generate prompts based on the goal and interactable elements.
   - Perform actions like clicking buttons or inputting text based on the response from the LLM model.
   
   Example:
   ```bash
   python auto.py
   ```

4. **Interact with Web Elements**:  
   The script will interact with the web page based on the actions generated by the LLM model (Groq). This includes:
   - Clicking buttons.
   - Filling out text inputs.
   - Selecting options.

## Code Overview

### Main Functions:

1. **generate_chat_completion(user_message)**:  
   Sends a user message to the Groq API to generate a chat completion for further processing.

2. **load_js_script()**:  
   Loads a JavaScript script (`domUtils.js`) to assist in building the DOM tree and extracting elements.

3. **load_prompt(template, **kwargs)**:  
   Loads a Jinja2 template to generate a prompt based on the specified template and arguments.

4. **build_element_dict(elements)**:  
   Creates dictionaries to map elements by their IDs to facilitate quick access for interaction.

5. **json_to_html(element, need_addition_attrs=True)**:  
   Converts JSON-based web elements into HTML representation.

6. **cleanup_element_tree_func(frame, url, element_tree)**:  
   Cleans up the element tree, removes unnecessary attributes, and processes elements for further interaction.

7. **run(playwright)**:  
   The main function to execute the entire automation process:
   - Opens a browser.
   - Loads a page.
   - Interacts with elements based on LLM-generated actions.
   - Closes the browser after performing the goal.

### Action Types:
- `CLICK`: Click an element.
- `INPUT_TEXT`: Input text into a field.
- `SELECT_OPTION`: Select an option from a dropdown.
- `CHECKBOX`: Interact with checkboxes.
- `WAIT`: Wait for a specific element.
- `NULL_ACTION`: No action.
- `TERMINATE`: Terminate the automation.
- `COMPLETE`: Mark the task as complete.

## Logging

The script uses **structlog** for logging, which provides structured and leveled logging for easier debugging and monitoring.

## Notes

- The script assumes that the web page contains identifiable elements that can be interacted with.
- Elements such as `svg`, `span`, `input`, and `button` are handled by default for interaction.
- SVG and CSS shapes can be converted to string descriptions using a secondary LLM for analysis.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.